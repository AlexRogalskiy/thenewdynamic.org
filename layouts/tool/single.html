{{ define "main" }}
    {{ $showcase := where (.Site.RegularPages) "Section" "showcase" }}
    {{ $related_showcase := $showcase.RelatedTo (keyVals "related_tools" .File.Path) }}
    {{ $tools := where (.Site.RegularPages) "Section" "tool" }}
    {{ $related_tools := ($tools).RelatedTo (keyVals "related_tools" .File.Path) }}
    {{ $links := where (.Site.RegularPages) "Section" "link" }}
    {{ $related_links := ($links).RelatedTo (keyVals "related_tools" .File.Path) }}

  <div class="page-list_default mx-auto min-h-screen max-w-5xl">Â 

    <div class="text-base mb-8 sm:mb-16 -mt-4">
      {{ with .Params.tools }}Type:
        {{ range  . }}
          {{ $taxonomy := index (where (($.Site.GetPage "taxonomyTerm" "tools").Pages) "Data.Term" .) 0 }}
            <a href="{{ $taxonomy.Permalink }}" class="dim font-sans inline-block bg-grey-dark mr-3 no-underline rounded-full px-3 py-1 text-sm text-white"{{ with $taxonomy.Params.color }} style="background-color:{{ . | default "grey" }};"{{ end }}>
              {{ $taxonomy.Title }}
            </a>
        {{ end }}
      {{ end }}

      {{ with .Param "headless-cms" }}
        {{ $taxonomy := index (where (($.Site.GetPage "taxonomyTerm" "headless-CMS").Pages) "Data.Term" .) 0 }}
          <a href="{{ $taxonomy.Permalink }}" class="dim font-sans inline-block bg-grey-dark mr-3 no-underline rounded-full px-3 py-1 text-sm text-white">
            Headless-CMS: {{ $taxonomy.Title }}
          </a>
        {{ end }}

      {{ with .Params.language }}Language:
        <a href="/language/{{ . | urlize }}" class="dim font-sans inline-block bg-grey-dark mr-3 no-underline rounded-full px-3 py-1 text-sm text-white">
          {{ . }}
        </a>
      {{ end }}
      {{ with .Params.license }}License:
        <a href="/license/{{ . | urlize }}" class="dim font-sans inline-block bg-grey-dark mr-3 no-underline rounded-full px-3 py-1 text-sm text-white">{{ . }}</a>
      {{ end }}
    </div>

    <div class="lg:grid-columns-3 grid-gap-16 sm:grid">
      <div class="max-w-smTK">
        <h2 class="mb-4">About {{ .Title }}</h2>
        {{ with .Content }}
          <div class="text-lg text-grey-darkest">
            {{/* this div you may only want if there's content */}}
            {{- . -}}
          </div>
        {{ end }}

        {{ with .Params.urls }}
          <div class="mt-8 text-lg">
            {{ range $key, $value := . }}
              {{ with $value }}
                <a href="{{ . }}" class="block dim no-underline text-grey-darkest">{{ $key  }} {{ partial "svg/link-external.svg" (dict "size" "12") }}</a>
              {{ end }}
            {{ end }}
          </div>
        {{ end }}

        {{ with $related_links }}
          <h3 class="my-8">Latest External Links</h3>
          <ul class="list-reset text-grey-darker">
            {{range first 5 .}}
              <li class="mb-4 border bg-grey-lighter">
                <a href="{{ with .Params.link }}{{ . }}{{ end }}" class="px-2 py-1 block hover:bg-grey-darkest hover:text-white no-underline text-grey-darker">{{.Title }}
                <div class="flex justify-between mt-2 text-xs">{{ with .Params.source }}by {{ . }} {{ end }} {{ partial "_components/time-short-format.html" (dict "context" . "show_time" false) }}</div>
                </a>
              </li>
          {{ end }}
          </ul>
          {{ if gt (len .) 5 }}
            <h4 class="my-8">
              <a href="#links" class="dim no-underline text-primary-color uppercase">
                  More Links <div class="align-middle inline-block">{{- partial "svg/chevron-right.svg" (dict "size" "15") -}}</div>
              </a>
            </h4>
          {{ end }}
        {{ end }}



      </div>

      <div class="">

        {{ with .Params.resources }}
        {{ if (index . 0) }}
          <h2>Resources</h2>
        {{ end }}

        {{ range .}}
          {{ $name := .name }}
          {{ with .url }}
            <a href="{{ . }}" class="block no-underline">{{ $name }} {{ partial "svg/link-external.svg" (dict "size" "12") }}</a>
          {{ end }}
        {{ end }}
        {{ end }}

        {{ with  .Params.related_tools }}
        <h2>Related Tools a</h2>
        {{ range .}}
        {{$related_tools := ($tools).RelatedTo (keyVals "related_tools" .)}}
<ul>


          {{with $related_tools}}{{range .}}
              <li>
                <a href="{{ .URL }}">{{.Title }}</a>
              </li>
          {{ end }}
        </ul>
          {{ end }}
        {{ end }}
        {{ end }}

          {{ with $related_tools }}
          <h2>Related Tools b</h2>
        {{range .}}
        <h5>
          <a href="{{ .URL }}">{{.Title}}</a>
        </h5>
        {{ end }}{{ end }}



      </div>

      <div class="">
        {{ with $related_showcase }}
          <h2 class="mb-4">{{ $.Title }} Showcase Sites</h2>
        <div class="grid-columns-2 grid-gap-4 sm:grid">
          {{ range . }}
            {{ $url := .URL }}
            {{ $image := index (.Params.images) 0 }}
          {{ with $image }}
            <a href="{{ $url }}" class="no-underline bg-black h-32 overflow-hidden">
              {{ if in (print $.Site.BaseURL) "localhost" }}
                <img data-src="{{ . }}" src="/images/placeholder.svg" class="lazyload mb-8 max-w-full border hover:opacity-25">
              {{ else }}
                {{ $img := replace . "/uploads" ($.Param "dev.image_url")  }}
                  <img src="/images/placeholder.svg" data-src="{{ $img }}?{{ (querify "w" "214" "h" "132" "fit" "crop") | safeURL }}" class="lazyload mb-8 max-w-full border hover:opacity-25">
              {{ end }}
            </a>
          {{ end }}

          {{ end }}
        </div>
        {{ end }}




      </div>
    </div>


    <div id="links" class="">
      LINKS
    </div>


  </div>
{{ end }}
